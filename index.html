<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>MD5 NEURAL HYBRID ‚Äì VIP MAX (Mobile)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
  <style>
    :root{
      --bg:#0b0e14; --card:#121722; --border:#2d333b; --accent:#00d2ff;
      --tai:#ff4d4d; --xiu:#38b6ff; --gold:#ffc107; --text:#adbac7;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100svh; background: radial-gradient(1200px 600px at 10% -10%, rgba(255,77,77,.12), transparent 40%),
      radial-gradient(900px 500px at 110% 10%, rgba(56,182,255,.12), transparent 45%), #0b0e14;
      color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto; display:flex; justify-content:center;
      padding: env(safe-area-inset-top) 10px env(safe-area-inset-bottom);
    }
    .app{
      width:100%; max-width:980px; background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.2)) , var(--card);
      border:1px solid var(--border); border-radius:18px; padding:12px; box-shadow:0 12px 40px rgba(0,0,0,.6);
      position:relative; overflow:hidden;
    }
    .app::before{
      content:""; position:fixed; inset:0; pointer-events:none;
      background: repeating-linear-gradient(to bottom, rgba(255,255,255,.03) 0px, rgba(255,255,255,.03) 1px, rgba(0,0,0,0) 2px, rgba(0,0,0,0) 4px);
      mix-blend-mode: overlay;
    }
    h1{margin:4px 0 2px; color:var(--gold); letter-spacing:1px; font-size:18px; text-shadow:0 0 12px rgba(255,193,7,.6),0 0 30px rgba(255,193,7,.35)}
    .sub{font-size:11px; color:#7d8590}

    .row{display:flex; gap:8px; margin:8px 0}
    input{
      flex:1; background:#0d1117; border:1px solid var(--border); color:var(--accent);
      padding:14px 12px; border-radius:12px; font-family:ui-monospace,monospace; font-size:14px
    }
    button{
      background: linear-gradient(135deg, #00d2ff, #4facfe); color:#001; border:0; border-radius:12px;
      padding:12px 14px; font-weight:900; cursor:pointer; box-shadow:0 6px 18px rgba(0,210,255,.35)
    }

    .grid{display:grid; grid-template-columns:1fr; gap:10px}
    @media (min-width: 900px){ .grid{ grid-template-columns: 1fr 1fr; } }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.2)), #0d1117;
      border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:12px; position:relative;
      box-shadow: 0 10px 30px rgba(0,0,0,.6), 0 0 24px rgba(0,210,255,.08);
      backdrop-filter: blur(6px);
    }
    .card::after{
      content:""; position:absolute; inset:-1px; border-radius:18px; pointer-events:none;
      background: linear-gradient(120deg, rgba(255,77,77,.35), rgba(56,182,255,.35), rgba(255,193,7,.35));
      opacity:.2; filter: blur(10px);
    }
    .hero{ border:1px solid rgba(0,210,255,.25); box-shadow:0 0 28px rgba(0,210,255,.25), 0 16px 40px rgba(0,0,0,.7) }

    .res{font-size:44px; font-weight:900; text-align:center; text-shadow:0 0 12px rgba(255,77,77,.6),0 0 28px rgba(255,77,77,.35)}
    .bar{height:10px; background:#222; border-radius:999px; overflow:hidden; display:flex; box-shadow: inset 0 0 12px rgba(0,0,0,.6), 0 0 10px rgba(0,210,255,.25)}
    .fill{height:100%}
    .meta{display:flex; justify-content:space-between; font-size:12px}
    .conf{margin-top:6px; text-align:center; font-size:12px}
    .warn{font-size:11px; text-align:center; margin-top:4px; color:#ff4d4d}

    table{width:100%; font-size:12px; border-collapse:collapse}
    th,td{border-bottom:1px solid #222; padding:6px}
    th{text-align:left; color:#9fb3c8}

    .terminal{background:#000; color:#00ff88; font-family:ui-monospace,monospace; font-size:11px; height:110px; overflow:auto; padding:10px; border-radius:12px}

    .pick-wrap{display:flex; gap:12px; justify-content:center; margin:12px 0}
    .pick{
      flex:1; max-width:160px; padding:14px 0; border-radius:999px; border:0;
      font-weight:900; font-size:16px; letter-spacing:1px; color:#fff; cursor:pointer;
      transition:.15s ease; box-shadow:0 10px 24px rgba(0,0,0,.5), 0 0 18px rgba(255,255,255,.15) inset;
    }
    .pick.tai{ background: linear-gradient(135deg, #ff4d4d, #ff7a7a); box-shadow:0 0 22px rgba(255,77,77,.55), 0 10px 24px rgba(0,0,0,.5) }
    .pick.xiu{ background: linear-gradient(135deg, #38b6ff, #7ad3ff); box-shadow:0 0 22px rgba(56,182,255,.55), 0 10px 24px rgba(0,0,0,.5) }
    .pick:active{ transform: scale(.97); }
    .pick:hover{ filter: brightness(1.1); }

    @keyframes pulse { 0%{transform:scale(1); box-shadow:0 0 0 0 rgba(255,77,77,.7)} 70%{transform:scale(1.06); box-shadow:0 0 0 14px rgba(255,77,77,0)} 100%{transform:scale(1); box-shadow:0 0 0 0 rgba(255,77,77,0)} }
    .pulse-tai{ animation:pulse 1.5s infinite }
    @keyframes pulseX { 0%{transform:scale(1); box-shadow:0 0 0 0 rgba(56,182,255,.7)} 70%{transform:scale(1.06); box-shadow:0 0 0 14px rgba(56,182,255,0)} 100%{transform:scale(1); box-shadow:0 0 0 0 rgba(56,182,255,0)} }
    .pulse-xiu{ animation:pulseX 1.5s infinite }

    .stats{font-size:12px; text-align:center; margin-top:6px}
    .hist{display:flex; gap:6px; flex-wrap:wrap; justify-content:center; margin-top:8px}
    .dot{width:24px; height:24px; border-radius:6px; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:800; font-size:11px}
    .ok{color:#00ff99} .bad{color:#ff4d4d}
  </style>
</head>
<body>
  <div class="app">
    <h1>MD5 NEURAL HYBRID ‚Äì VIP MAX</h1>
    <div class="sub">Mobile-first ‚Ä¢ Neon UI ‚Ä¢ AI PRO ‚Ä¢ MD5 VIP ‚Ä¢ SAFE MODE ‚Ä¢ Verify MD5</div>

    <div class="row">
      <input id="md5Input" placeholder="D√°n MD5 32 k√Ω t·ª±..." maxlength="32"/>
      <button onclick="startAnalysis()">PH√ÇN T√çCH</button>
    </div>

    <div class="grid">
      <div class="card hero">
        <div class="sub" style="text-align:center">D·ª∞ ƒêO√ÅN</div>
        <div id="mainResult" class="res">---</div>
        <div class="bar">
          <div id="barTai" class="fill" style="background:var(--tai); width:50%"></div>
          <div id="barXiu" class="fill" style="background:var(--xiu); width:50%"></div>
        </div>
        <div class="meta">
          <span id="lbTai" style="color:var(--tai)">T√ÄI: 50%</span>
          <span id="lbXiu" style="color:var(--xiu)">X·ªàU: 50%</span>
        </div>
        <div class="conf">
          ƒê·ªô tin c·∫≠y: <b id="confScore" style="color:#00ffcc">0%</b> ‚Ä¢ 
          Khuy·∫øn ngh·ªã: <b id="safeMode" style="color:#ffc107">---</b>
        </div>
        <div id="riskWarn" class="warn"></div>
      </div>

      <div class="card">
        <div class="sub" style="margin-bottom:6px">TR·∫†NG TH√ÅI ENGINE</div>
        <div>Markov: <b id="stMarkov">--</b></div>
        <div>Xu h∆∞·ªõng: <b id="stTrend">--</b></div>
        <div>T·∫ßn su·∫•t: <b id="stFreq">--</b></div>
        <div>Chu·ªói: <b id="stChain">--</b></div>
        <div>MD5 VIP: <b id="stMd5">--</b></div>
      </div>

      <div class="card">
        <div class="sub" style="margin-bottom:6px">üß¨ MD5 VIP ANALYSIS</div>
        <table>
          <thead><tr><th>Kh·ªëi</th><th>Hex</th><th align="right">T·ªïng</th><th align="right">L·ª±c</th><th align="center">Vote</th></tr></thead>
          <tbody id="md5SegBody"></tbody>
        </table>
        <div style="margin-top:6px; font-size:12px">
          Engines: <span id="md5VecRes">Vector: --</span> | <span id="md5ParRes">Parity: --</span> | <span id="md5EntRes">Entropy: --</span>
        </div>
        <div style="margin-top:4px; font-size:12px">
          MD5 T·ªïng h·ª£p: <b id="md5VipRes" style="color:#00ffcc">--</b> ‚Ä¢ ƒê·ªô tin c·∫≠y: <b id="md5VipConf" style="color:#ffc107">0%</b>
        </div>
      </div>

      <div class="card terminal" id="logBox">> Ready.</div>
    </div>

    <div class="pick-wrap">
      <button class="pick tai" id="btnTai" onclick="feedResult('T√ÄI')">T√ÄI</button>
      <button class="pick xiu" id="btnXiu" onclick="feedResult('X·ªàU')">X·ªàU</button>
    </div>

    <div class="stats" id="vipStats">T·ªïng: 0 | Win: 0 | Lose: 0 | Winrate: 0%</div>
    <div class="hist" id="hist"></div>

    <div class="card" style="margin-top:10px">
      <div class="sub" style="margin-bottom:6px">üîé KI·ªÇM TRA MINH B·∫†CH MD5</div>
      <div class="row">
        <input id="md5Provided" placeholder="MD5 nh√† c√°i c√¥ng b·ªë tr∆∞·ªõc v√°n"/>
      </div>
      <div class="row">
        <input id="resultString" placeholder="Chu·ªói k·∫øt qu·∫£ sau v√°n (ƒë·ªÉ hash MD5)"/>
        <button onclick="checkMD5()">KI·ªÇM TRA</button>
      </div>
      <div style="font-size:12px; margin-top:6px">MD5 t√≠nh to√°n: <b id="md5Calc" style="color:#00ffcc">---</b></div>
      <div id="md5Status" style="font-size:12px; margin-top:4px;"></div>
      <div class="terminal" id="md5Log" style="margin-top:8px; height:120px"></div>
    </div>
  </div>

<script>
let history = JSON.parse(localStorage.getItem("hist")) || [];
let stats = JSON.parse(localStorage.getItem("stats")) || {total:0, win:0, lose:0};
let weights = JSON.parse(localStorage.getItem("weights")) || {markov:1, trend:1, freq:1, chain:1, md5:1};
let loseStreak = Number(localStorage.getItem("loseStreak") || 0);
let lastPredict = null;
let lastMd5 = localStorage.getItem("lastMd5") || null;

const addLog = (m)=>{ const b=logBox; b.innerHTML += "<div>"+m+"</div>"; b.scrollTop=b.scrollHeight; };
const renderHist = ()=>{ hist.innerHTML = history.slice(-24).reverse().map(h=>`<div class="dot" style="background:${h==='T√ÄI'?'var(--tai)':'var(--xiu)'}">${h==='T√ÄI'?'T':'X'}</div>`).join(""); };
const renderStats = ()=>{ const wr = stats.total? ((stats.win/stats.total)*100).toFixed(1):0; vipStats.innerText = `T·ªïng: ${stats.total} | Win: ${stats.win} | Lose: ${stats.lose} | Winrate: ${wr}%`; };

function phuongPhapChuoi(d){ if(!d.length) return "T√ÄI"; let last=d[d.length-1], c=1; for(let i=d.length-2;i>=0;i--){ if(d[i]===last)c++; else break; } return c>=4 ? (last? "X·ªàU":"T√ÄI") : (last? "T√ÄI":"X·ªàU"); }
function phuongPhapXuHuong(d){ if(d.length<5) return "T√ÄI"; let s=0; for(let i=1;i<d.length;i++) d[i]===d[i-1]? s++:s--; return s>0? (d[d.length-1]? "T√ÄI":"X·ªàU"):(d[d.length-1]? "X·ªàU":"T√ÄI"); }
function phuongPhapTanSuat(d){ let t=d.filter(x=>x===1).length; return t>d.length/2? "T√ÄI":"X·ªàU"; }
function phuongPhapMarkov(d){ if(d.length<5) return "T√ÄI"; let m=[[0,0],[0,0]]; for(let i=1;i<d.length;i++) m[d[i-1]][d[i]]++; let cur=d[d.length-1]; return m[cur][1]>m[cur][0]? "T√ÄI":"X·ªàU"; }

function md5VipAnalysis(md5){
  let segVotes=[], totalForce=0; md5SegBody.innerHTML="";
  for(let i=0;i<4;i++){
    const seg = md5.substr(i*8,8); let sum=0; for(const c of seg) sum+=parseInt(c,16);
    const vote = sum>60? "T√ÄI":"X·ªàU"; totalForce+=sum; segVotes.push(vote);
    md5SegBody.innerHTML+=`<tr><td>#${i+1}</td><td>${seg}</td><td align="right">${sum}</td><td align="right">${Math.min(100,Math.round((sum/120)*100))}%</td><td align="center" style="color:${vote==='T√ÄI'?'var(--tai)':'var(--xiu)'}">${vote}</td></tr>`;
  }
  const vecRes = totalForce>240? "T√ÄI":"X·ªàU";
  let even=0, odd=0; for(const c of md5) (parseInt(c,16)%2===0)? even++:odd++; const parRes = even>odd? "T√ÄI":"X·ªàU";
  const uniq = new Set(md5.split("")).size; const entRes = uniq>12? "T√ÄI":"X·ªàU";
  let votes=[vecRes, parRes, entRes, ...segVotes];
  let tai=votes.filter(v=>v==="T√ÄI").length, xiu=votes.length-tai;
  const final = tai>xiu? "T√ÄI":"X·ªàU"; const conf = Math.round((Math.max(tai,xiu)/votes.length)*100);
  md5VecRes.innerText = "Vector: "+vecRes; md5ParRes.innerText="Parity: "+parRes; md5EntRes.innerText="Entropy: "+entRes;
  md5VipRes.innerText=final; md5VipRes.style.color = final==="T√ÄI"?"var(--tai)":"var(--xiu)"; md5VipConf.innerText=conf+"%";
  return {final, conf};
}

function setPulse(final, safe){
  btnTai.classList.remove("pulse-tai"); btnXiu.classList.remove("pulse-xiu");
  if(safe==="THEO"){ final==="T√ÄI" ? btnTai.classList.add("pulse-tai") : btnXiu.classList.add("pulse-xiu"); }
}

function startAnalysis(){
  const md5 = md5Input.value.trim().toLowerCase();
  if(!/^[a-f0-9]{32}$/.test(md5)) return alert("MD5 kh√¥ng h·ª£p l·ªá!");
  if(md5===lastMd5) return addLog("> ‚ùå Tr√πng phi√™n, b·ªè qua.");

  lastMd5 = md5; addLog("> Qu√©t MD5: "+md5);

  const data = history.map(x=> x==="T√ÄI"?1:0);
  const pChain = phuongPhapChuoi(data), pTrend = phuongPhapXuHuong(data), pFreq = phuongPhapTanSuat(data), pMark = phuongPhapMarkov(data);
  const vip = md5VipAnalysis(md5); const pMd5 = vip.final;

  stChain.innerText=pChain; stTrend.innerText=pTrend; stFreq.innerText=pFreq; stMarkov.innerText=pMark; stMd5.innerText=pMd5;

  let tai=0, xiu=0;
  [["chain",pChain],["trend",pTrend],["freq",pFreq],["markov",pMark],["md5",pMd5]].forEach(([k,v])=>{ if(v==="T√ÄI") tai+=weights[k]; else xiu+=weights[k]; });

  const total=tai+xiu, final = tai>xiu? "T√ÄI":"X·ªàU", conf = total? Math.round((Math.max(tai,xiu)/total)*100):50;
  lastPredict = final;

  mainResult.innerText=final; mainResult.style.color = final==="T√ÄI"?"var(--tai)":"var(--xiu)";
  barTai.style.width = conf+"%"; barXiu.style.width = (100-conf)+"%";
  lbTai.innerText = "T√ÄI: "+conf+"%"; lbXiu.innerText = "X·ªàU: "+(100-conf)+"%";
  confScore.innerText = conf+"%"; safeMode.innerText = conf>=70? "THEO":"KH√îNG THEO"; safeMode.style.color = conf>=70? "#00ff99":"#ff4d4d";
  riskWarn.innerText = loseStreak>=2? "‚ö†Ô∏è AI ƒëang thua li√™n ti·∫øp ‚Äì c√¢n nh·∫Øc gi·∫£m c∆∞·ª£c":"";

  setPulse(final, safeMode.innerText); addLog(`> AI PRO: ${final} (${conf}%)`);
}

function feedResult(real){
  if(!lastPredict) return alert("Ch∆∞a c√≥ d·ª± ƒëo√°n!");
  stats.total++; if(real===lastPredict){ stats.win++; loseStreak=0; } else { stats.lose++; loseStreak++; }
  const data = history.map(x=> x==="T√ÄI"?1:0);
  const pChain = phuongPhapChuoi(data), pTrend = phuongPhapXuHuong(data), pFreq = phuongPhapTanSuat(data), pMark = phuongPhapMarkov(data);
  const vip = md5VipAnalysis(lastMd5); const pMd5 = vip.final;
  [["chain",pChain],["trend",pTrend],["freq",pFreq],["markov",pMark],["md5",pMd5]].forEach(([k,v])=>{ if(v===real) weights[k]+=0.1; else weights[k]=Math.max(0.5, weights[k]-0.1); });
  history.push(real); if(history.length>60) history.shift();
  renderHist(); renderStats(); addLog(`> K·∫øt qu·∫£ th·ª±c: ${real} ‚Üí ${real===lastPredict?"WIN":"LOSE"}`);
}

function checkMD5(){
  const provided = md5Provided.value.trim().toLowerCase(), resultStr = resultString.value;
  if(!provided || !resultStr) return alert("Nh·∫≠p ƒë·ªß MD5 v√† chu·ªói k·∫øt qu·∫£!");
  const calc = CryptoJS.MD5(resultStr).toString(); md5Calc.innerText = calc;
  const ok = calc === provided;
  md5Status.innerHTML = ok ? `<span class="ok">‚úÖ K·∫æT QU·∫¢ KH·ªöP ‚Äì Minh b·∫°ch</span>` : `<span class="bad">‚ùå SAI L·ªÜCH ‚Äì C√≥ th·ªÉ nh·∫≠p sai chu·ªói ho·∫∑c d·ªØ li·ªáu kh√¥ng kh·ªõp</span>`;
  md5Log.innerHTML += `> MD5 nh√† c√°i: ${provided}<br>> MD5 t√≠nh ƒë∆∞·ª£c: ${calc}<br>> Tr·∫°ng th√°i: ${ok?"KH·ªöP":"SAI"}<br><br>`; md5Log.scrollTop = md5Log.scrollHeight;
  md5Provided.value=""; resultString.value="";
}

renderHist(); renderStats();
</script>
</body>
</html>
<body>
  <div class="app">
    <h1>MD5 NEURAL HYBRID ‚Äì AI PRO (ALL-IN-ONE)</h1>
    <div class="sub">D·ª± ƒëo√°n AI + Confidence + SAFE MODE + T·ª± h·ªçc + Ki·ªÉm tra minh b·∫°ch MD5</div>

    <!-- AI PREDICT -->
    <div class="row">
      <input id="md5Input" placeholder="D√°n MD5 32 k√Ω t·ª±..." maxlength="32"/>
      <button onclick="startAnalysis()">PH√ÇN T√çCH</button>
    </div>

    <div class="grid">
      <div class="card">
        <div class="sub" style="text-align:center">D·ª∞ ƒêO√ÅN</div>
        <div id="mainResult" class="res">---</div>
        <div class="bar">
          <div id="barTai" class="fill" style="background:var(--tai); width:50%"></div>
          <div id="barXiu" class="fill" style="background:var(--xiu); width:50%"></div>
        </div>
        <div class="meta">
          <span id="lbTai" style="color:var(--tai)">T√ÄI: 50%</span>
          <span id="lbXiu" style="color:var(--xiu)">X·ªàU: 50%</span>
        </div>
        <div class="conf">
          ƒê·ªô tin c·∫≠y: <b id="confScore" style="color:#00ffcc">0%</b> ‚Ä¢ 
          Khuy·∫øn ngh·ªã: <b id="safeMode" style="color:#ffc107">---</b>
        </div>
        <div id="riskWarn" class="warn"></div>
      </div>

      <div class="card">
        <div class="sub" style="margin-bottom:6px">TR·∫†NG TH√ÅI ENGINE</div>
        <div>Markov: <b id="stMarkov">--</b></div>
        <div>Xu h∆∞·ªõng: <b id="stTrend">--</b></div>
        <div>T·∫ßn su·∫•t: <b id="stFreq">--</b></div>
        <div>Chu·ªói: <b id="stChain">--</b></div>
        <div>MD5 Vector: <b id="stMd5">--</b></div>
      </div>

      <div class="card full terminal" id="logBox">> Ready.</div>
    </div>

    <div class="btns">
      <button onclick="feedResult('T√ÄI')">Nh·∫≠p KQ: T√ÄI</button>
      <button onclick="feedResult('X·ªàU')">Nh·∫≠p KQ: X·ªàU</button>
      <button onclick="clearAll()" style="background:#333;color:#aaa">Reset AI</button>
    </div>

    <div class="stats" id="vipStats">T·ªïng: 0 | Win: 0 | Lose: 0 | Winrate: 0%</div>
    <div class="hist" id="hist"></div>

    <!-- MD5 VERIFY -->
    <div class="card full" style="margin-top:12px">
      <div class="sub" style="margin-bottom:6px">üîé KI·ªÇM TRA MINH B·∫†CH MD5</div>
      <div class="row">
        <input id="md5Provided" placeholder="MD5 nh√† c√°i c√¥ng b·ªë tr∆∞·ªõc v√°n"/>
      </div>
      <div class="row">
        <input id="resultString" placeholder="Chu·ªói k·∫øt qu·∫£ sau v√°n (ƒë·ªÉ hash MD5)"/>
        <button onclick="checkMD5()">KI·ªÇM TRA</button>
      </div>

      <div style="font-size:12px; margin-top:6px">
        MD5 t√≠nh to√°n: <b id="md5Calc" style="color:#00ffcc">---</b>
      </div>
      <div id="md5Status" style="font-size:12px; margin-top:4px;"></div>

      <div class="terminal" id="md5Log" style="margin-top:8px; height:120px"></div>
    </div>
  </div>

<script>
let history = JSON.parse(localStorage.getItem("hist")) || [];
let stats = JSON.parse(localStorage.getItem("stats")) || {total:0, win:0, lose:0};
let weights = JSON.parse(localStorage.getItem("weights")) || {markov:1, trend:1, freq:1, chain:1, md5:1};
let loseStreak = Number(localStorage.getItem("loseStreak") || 0);
let lastPredict = null;
let lastMd5 = localStorage.getItem("lastMd5") || null;

function save(){
  localStorage.setItem("hist", JSON.stringify(history));
  localStorage.setItem("stats", JSON.stringify(stats));
  localStorage.setItem("weights", JSON.stringify(weights));
  localStorage.setItem("loseStreak", loseStreak);
  if(lastMd5) localStorage.setItem("lastMd5", lastMd5);
}
function addLog(m){ const b=document.getElementById("logBox"); b.innerHTML += "<div>"+m+"</div>"; b.scrollTop=b.scrollHeight; }
function renderHist(){
  hist.innerHTML = history.slice(-24).reverse().map(h=>`<div class="dot" style="background:${h==='T√ÄI'?'var(--tai)':'var(--xiu)'}">${h==='T√ÄI'?'T':'X'}</div>`).join("");
}
function renderStats(){
  const wr = stats.total? ((stats.win/stats.total)*100).toFixed(1):0;
  vipStats.innerText = `T·ªïng: ${stats.total} | Win: ${stats.win} | Lose: ${stats.lose} | Winrate: ${wr}%`;
}
function phuongPhapChuoi(d){ if(!d.length) return "T√ÄI"; let last=d[d.length-1], c=1; for(let i=d.length-2;i>=0;i--){ if(d[i]===last)c++; else break; } return c>=4 ? (last? "X·ªàU":"T√ÄI") : (last? "T√ÄI":"X·ªàU"); }
function phuongPhapXuHuong(d){ if(d.length<5) return "T√ÄI"; let s=0; for(let i=1;i<d.length;i++) d[i]===d[i-1]? s++:s--; return s>0? (d[d.length-1]? "T√ÄI":"X·ªàU"):(d[d.length-1]? "X·ªàU":"T√ÄI"); }
function phuongPhapTanSuat(d){ let t=d.filter(x=>x===1).length; return t>d.length/2? "T√ÄI":"X·ªàU"; }
function phuongPhapMarkov(d){ if(d.length<5) return "T√ÄI"; let m=[[0,0],[0,0]]; for(let i=1;i<d.length;i++) m[d[i-1]][d[i]]++; let cur=d[d.length-1]; return m[cur][1]>m[cur][0]? "T√ÄI":"X·ªàU"; }
function md5Vector(md5){
  let ascii=0, vec=0;
  for(let i=0;i<32;i++){ ascii+=md5.charCodeAt(i)*(i+1); vec+=parseInt(md5[i],16)*(32-i); }
  return ((ascii+vec)%1000)>500? "T√ÄI":"X·ªàU";
}

function startAnalysis(){
  const md5 = md5Input.value.trim().toLowerCase();
  if(!/^[a-f0-9]{32}$/.test(md5)) return alert("MD5 kh√¥ng h·ª£p l·ªá!");
  if(md5===lastMd5) return addLog("> ‚ùå Tr√πng phi√™n, b·ªè qua.");

  lastMd5 = md5;
  addLog("> Qu√©t MD5: "+md5);

  const data = history.map(x=> x==="T√ÄI"?1:0);
  const pChain = phuongPhapChuoi(data);
  const pTrend = phuongPhapXuHuong(data);
  const pFreq  = phuongPhapTanSuat(data);
  const pMark  = phuongPhapMarkov(data);
  const pMd5   = md5Vector(md5);

  stChain.innerText=pChain; stTrend.innerText=pTrend; stFreq.innerText=pFreq; stMarkov.innerText=pMark; stMd5.innerText=pMd5;

  let tai=0, xiu=0;
  [["chain",pChain],["trend",pTrend],["freq",pFreq],["markov",pMark],["md5",pMd5]].forEach(([k,v])=>{
    if(v==="T√ÄI") tai+=weights[k]; else xiu+=weights[k];
  });

  const total=tai+xiu;
  const final = tai>xiu? "T√ÄI":"X·ªàU";
  const conf = total? Math.round((Math.max(tai,xiu)/total)*100):50;

  lastPredict = final;

  mainResult.innerText=final;
  mainResult.style.color = final==="T√ÄI"?"var(--tai)":"var(--xiu)";
  barTai.style.width = conf+"%";
  barXiu.style.width = (100-conf)+"%";
  lbTai.innerText = "T√ÄI: "+conf+"%";
  lbXiu.innerText = "X·ªàU: "+(100-conf)+"%";
  confScore.innerText = conf+"%";
  safeMode.innerText = conf>=70? "THEO":"KH√îNG THEO";
  safeMode.style.color = conf>=70? "#00ff99":"#ff4d4d";
  riskWarn.innerText = loseStreak>=2? "‚ö†Ô∏è AI ƒëang thua li√™n ti·∫øp ‚Äì c√¢n nh·∫Øc gi·∫£m c∆∞·ª£c":"";

  addLog(`> AI PRO: ${final} (${conf}%)`);
  save();
}

function feedResult(real){
  if(!lastPredict) return alert("Ch∆∞a c√≥ d·ª± ƒëo√°n!");
  stats.total++;
  if(real===lastPredict){ stats.win++; loseStreak=0; }
  else { stats.lose++; loseStreak++; }

  const data = history.map(x=> x==="T√ÄI"?1:0);
  const pChain = phuongPhapChuoi(data);
  const pTrend = phuongPhapXuHuong(data);
  const pFreq  = phuongPhapTanSuat(data);
  const pMark  = phuongPhapMarkov(data);
  const pMd5   = md5Vector(lastMd5);

  [["chain",pChain],["trend",pTrend],["freq",pFreq],["markov",pMark],["md5",pMd5]].forEach(([k,v])=>{
    if(v===real) weights[k]+=0.1; else weights[k]=Math.max(0.5, weights[k]-0.1);
  });

  history.push(real); if(history.length>60) history.shift();
  addLog(`> K·∫øt qu·∫£ th·ª±c: ${real} ‚Üí ${real===lastPredict?"WIN":"LOSE"}`);
  renderHist(); renderStats(); save();
}

function checkMD5(){
  const provided = md5Provided.value.trim().toLowerCase();
  const resultStr = resultString.value;

  if(!provided || !resultStr) return alert("Nh·∫≠p ƒë·ªß MD5 v√† chu·ªói k·∫øt qu·∫£!");

  const calc = CryptoJS.MD5(resultStr).toString();
  md5Calc.innerText = calc;

  const ok = calc === provided;
  md5Status.innerHTML = ok
    ? `<span class="ok">‚úÖ K·∫æT QU·∫¢ KH·ªöP ‚Äì Minh b·∫°ch</span>`
    : `<span class="bad">‚ùå SAI L·ªÜCH ‚Äì C√≥ th·ªÉ nh·∫≠p sai chu·ªói ho·∫∑c d·ªØ li·ªáu kh√¥ng kh·ªõp</span>`;

  md5Log.innerHTML += `> MD5 nh√† c√°i: ${provided}<br>> MD5 t√≠nh ƒë∆∞·ª£c: ${calc}<br>> Tr·∫°ng th√°i: ${ok?"KH·ªöP":"SAI"}<br><br>`;
  md5Log.scrollTop = md5Log.scrollHeight;
}

function clearAll(){
  if(!confirm("Reset to√†n b·ªô d·ªØ li·ªáu AI?")) return;
  history=[]; stats={total:0,win:0,lose:0}; weights={markov:1,trend:1,freq:1,chain:1,md5:1};
  loseStreak=0; lastPredict=null; lastMd5=null; localStorage.clear();
  renderHist(); renderStats(); addLog("> Reset xong.");
}

renderHist(); renderStats();
</script>
</body>
</html>
